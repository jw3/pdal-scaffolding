#!/usr/bin/env bash

IFS= read -p "plugin type [f/k/r/w]: " type

IFS= read -p "$type name: " name
if [[ -z "$name" ]]; then echo "name required"; exit 1; fi

IFS= read -p "output directory [default: /tmp/$name]: " target_dir
if [[ -z "$target_dir" ]]; then target_dir="/tmp/$name"; fi

IFS= read -p "$type namespace [default: none]: " ns

echo ""

readonly src_dir=$PWD
readonly build_dir="$target_dir/cmake-build-scaffolding"

echo "scaffolding from $build_dir ..."
echo "type: $type"
echo "name: $name"
echo "namespace: $ns"
echo "destination: $target_dir"

mkdir -p "$build_dir"
cd "$build_dir"
cmake "$src_dir" -DPLUGIN_TYPE=filter -DPLUGIN_NAME="$name" -DPLUGIN_NAMESPACE="$ns" -DTARGET_DIR="$target_dir"

IFS= read -p "initialize conan for clion [y/n]: " init_conan
if [[ "$init_conan" == "y" ]]; then
 conan install "$target_dir" -s build_type=Debug --install-folder="$target_dir"/cmake-build-debug
fi

cd "$src_dir"
echo "scaffolding complete, $build_dir can be deleted"
